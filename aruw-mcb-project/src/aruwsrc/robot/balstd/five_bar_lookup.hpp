/*
 * Copyright (c) 2023-2023 Advanced Robotics at the University of Washington <robomstr@uw.edu>
 *
 * This file is part of aruw-mcb.
 *
 * aruw-mcb is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * aruw-mcb is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with aruw-mcb.  If not, see <https://www.gnu.org/licenses/>.
 */

#ifndef FIVE_BAR_LOOKUP_HPP_
#define FIVE_BAR_LOOKUP_HPP_
#include <array>

#include "tap/algorithms/cmsis_mat.hpp"

using namespace tap::algorithms;

namespace aruwsrc::chassis
{

static const float FIVE_BAR_T1_MIN = 1.83259571459405;
static const float FIVE_BAR_T1_MAX = 3.49065850398866;
static const float FIVE_BAR_T1_DELTA = 0.08726646259971016;
static const float FIVE_BAR_T4_MIN = -0.349065850398866;
static const float FIVE_BAR_T4_MAX = 1.30899693899575;
static const float FIVE_BAR_T4_DELTA = 0.08726646259971699;
static const std::array<std::array<short, 20>, 20> VMC_J11 = {{
    {-1110, -1117, -1117, -1111, -1098, -1079, -1054, -1022, -984, -941,
     -893,  -841,  -785,  -728,  -669,  -610,  -551,  -494,  -438, -385},
    {-1104, -1115, -1119, -1117, -1109, -1094, -1072, -1044, -1010, -969,
     -924,  -874,  -820,  -763,  -704,  -645,  -585,  -527,  -584,  -414},
    {-1094, -1109, -1117, -1120, -1115, -1104, -1087, -1063, -1032, -995,
     -953,  -905,  -853,  -798,  -740,  -680,  -620,  -561,  -502,  -446},
    {-1080, -1099, -1111, -1117, -1117, -1111, -1097, -1077, -1050, -1017,
     -978,  -934,  -884,  -831,  -774,  -715,  -656,  -596,  -536,  -478},
    {-1062, -1084, -1101, -1111, -1115, -1112, -1103, -1087, -1065, -1036,
     -1001, -959,  -913,  -862,  -807,  -846,  -691,  -631,  -571,  -513},
    {-1040, -1066, -1086, -1100, -1108, -1110, -1105, -1093, -1075, -1050,
     -1019, -982,  -939,  -891,  -839,  -783,  -725,  -666,  -607,  -548},
    {-1014, -1044, -1068, -1086, -1097, -1103, -1102, -1095, -1081, -1060,
     -1033, -1000, -961,  -917,  -867,  -814,  -759,  -701,  -642,  -583},
    {-986,  -1019, -1046, -1067, -1082, -1092, -1095, -1092, -1082, -1066,
     -1043, -1014, -1016, -939,  -893,  -843,  -790,  -734,  -677,  -619},
    {-954,  -990,  -1020, -1045, -1064, -1077, -1084, -1085, -1079, -1067,
     -1049, -1024, -994,  -957,  -915,  -869,  -819,  -765,  -710,  -653},
    {-920,  -958,  -991,  -1019, -1041, -1058, -1069, -1073, -1072, -1064,
     -1050, -1030, -1004, -971,  -934,  -891,  -844,  -794,  -741,  -686},
    {-883,  -924,  -960,  -990, -1016, -1035, -1050, -1058, -1060, -1057,
     -1047, -1031, -1009, -981, -948,  -910,  -867,  -820,  -770,  -718},
    {-843,  -887,  -925,  -959, -987, -1010, -1027, -1039, -1045, -1045,
     -1040, -1028, -1010, -987, -958, -924,  -885,  -842,  -795,  -746},
    {-802,  -848,  -889,  -924, -955, -981, -1001, -1016, -1026, -1030,
     -1028, -1021, -1007, -989, -964, -934, -900,  -861,  -818,  -772},
    {-759,  -807,  -850,  -888, -921, -949, -972, -990, -1003, -1011,
     -1013, -1009, -1000, -986, -966, -940, -910, -875, -836,  -794},
    {-715, -765, -809, -849, -884, -915, -941, -962, -978, -988,
     -994, -994, -989, -979, -963, -942, -916, -886, -851, -813},
    {-670, -721, -767, -808, -846, -878, -906, -930, -949, -963,
     -972, -975, -974, -968, -956, -939, -918, -892, -862, -827},
    {-624, -676, -723, -766, -805, -840, -870, -896, -917, -934,
     -946, -953, -956, -953, -945, -933, -916, -894, -868, -838},
    {-577, -630, -678, -723, -763, -799, -831, -859, -883, -902,
     -917, -928, -933, -934, -931, -922, -909, -892, -870, -844},
    {-530, -584, -633, -678, -719, -756, -790, -820, -846, -868,
     -886, -899, -908, -912, -912, -908, -899, -886, -868, -847},
    {-484, -537, -586, -632, -674, -712, -748, -779, -807, -831,
     -851, -867, -879, -887, -891, -890, -885, -875, -862, -845},
}};  // VMC_J11
static const std::array<std::array<short, 20>, 20> VMC_J12 = {{
    {845, 847, 844, 838, 827, 813, 794, 772, 746, 718,
     686, 653, 619, 583, 548, 513, 478, 446, 414, 385},
    {862, 868, 870, 868, 862, 851, 836, 818, 795, 770,
     741, 710, 677, 642, 607, 571, 536, 502, 584, 438},
    {875, 886, 892, 894, 892, 886, 875, 861, 842, 820,
     794, 765, 734, 701, 666, 631, 596, 561, 527, 494},
    {885, 899, 909, 916, 918, 916, 910, 900, 885, 867,
     844, 819, 790, 759, 725, 691, 656, 620, 585, 551},
    {890, 908, 922, 933, 939, 942, 940, 934, 924, 910,
     891, 869, 843, 814, 783, 846, 715, 680, 645, 610},
    {891, 912, 931, 945, 956, 963, 966, 964, 958, 948,
     934, 915, 893, 867, 839, 807, 774, 740, 704, 669},
    {887, 912, 934, 953, 968, 979, 986, 989, 987, 981,
     971, 957, 939, 917, 891, 862, 831, 798, 763, 728},
    {879,  908, 933,  956, 974, 989, 1000, 1007, 1010, 1009,
     1004, 994, 1016, 961, 939, 913, 884,  853,  820,  785},
    {867,  899,  928,  953,  975, 994, 1009, 1021, 1028, 1031,
     1030, 1024, 1014, 1000, 982, 959, 934,  905,  874,  841},
    {851,  886,  917,  946,  972,  994,  1013, 1028, 1040, 1047,
     1050, 1049, 1043, 1033, 1019, 1001, 978,  953,  924,  893},
    {831,  868,  902,  934,  963,  988,  1011, 1030, 1045, 1057,
     1064, 1067, 1066, 1060, 1050, 1036, 1017, 995,  969,  941},
    {807,  846,  883,  917,  949,  978,  1003, 1026, 1045, 1060,
     1072, 1079, 1082, 1081, 1075, 1065, 1050, 1032, 1010, 984},
    {779,  820,  859,  896,  930,  962,  990,  1016, 1039, 1058,
     1073, 1085, 1092, 1095, 1093, 1087, 1077, 1063, 1044, 1022},
    {748,  790,  831,  870,  906,  941,  972,  1001, 1027, 1050,
     1069, 1084, 1095, 1102, 1105, 1103, 1097, 1087, 1072, 1054},
    {712,  756,  799,  840,  878,  915,  949,  981,  1010, 1035,
     1058, 1077, 1092, 1103, 1110, 1112, 1111, 1104, 1094, 1079},
    {674,  719,  763,  805,  846,  884,  921,  955,  987,  1016,
     1041, 1064, 1082, 1097, 1108, 1115, 1117, 1115, 1109, 1098},
    {632,  678,  723,  766,  808,  849,  888,  924,  959,  990,
     1019, 1045, 1067, 1086, 1100, 1111, 1117, 1120, 1117, 1111},
    {586, 633,  678,  723,  767,  809,  850,  889,  925,  960,
     991, 1020, 1046, 1068, 1086, 1101, 1111, 1117, 1119, 1117},
    {537, 584, 630,  676,  721,  765,  807,  848,  887,  924,
     958, 990, 1019, 1044, 1066, 1084, 1099, 1109, 1115, 1117},
    {484, 530, 577, 624,  670,  715,  759,  802,  843,  883,
     920, 954, 986, 1014, 1040, 1062, 1080, 1094, 1104, 1110},
}};  // VMC_J12
static const std::array<std::array<short, 20>, 20> VMC_J21 = {{
    {4067, 4121, 4167, 4206, 4237, 4261, 4275, 4280, 4274, 4255,
     4221, 4169, 4099, 4007, 3892, 3753, 3588, 3397, 3180, 2940},
    {3995, 4052, 4100, 4140, 4172, 4195, 4210, 4216, 4210, 4192,
     4160, 4112, 4046, 3959, 3850, 3718, 3561, 3380, 3419, 2946},
    {3929, 3988, 4039, 4080, 4114, 4139, 4155, 4161, 4157, 4140,
     4111, 4065, 4003, 3921, 3819, 3694, 3546, 3375, 3180, 2963},
    {3867, 3930, 3984, 4028, 4063, 4089, 4107, 4115, 4112, 4098,
     4070, 4028, 3970, 3894, 3798, 3681, 3542, 3380, 3196, 2990},
    {3809, 3877, 3933, 3980, 4018, 4047, 4066, 4076, 4075, 4063,
     4039, 4000, 3947, 3876, 3786, 3790, 3546, 3394, 3221, 3026},
    {3754, 3827, 3888, 3938, 3979, 4010, 4031, 4043, 4045, 4036,
     4015, 3980, 3931, 3865, 3782, 3680, 3559, 3416, 3254, 3071},
    {3702, 3780, 3845, 3900, 3944, 3978, 4002, 4017, 4022, 4015,
     3997, 3967, 3922, 3862, 3786, 3691, 3578, 3446, 3293, 3122},
    {3652, 3736, 3807, 3865, 3913, 3951, 3978, 3996, 4003, 4000,
     3986, 3959, 3951, 3865, 3795, 3708, 3604, 3481, 3339, 3179},
    {3603, 3694, 3771, 3834, 3886, 3927, 3958, 3979, 3990, 3990,
     3979, 3957, 3922, 3873, 3809, 3730, 3634, 3520, 3389, 3240},
    {3556, 3654, 3737, 3806, 3863, 3908, 3942, 3966, 3981, 3984,
     3977, 3959, 3929, 3885, 3828, 3756, 3668, 3564, 3442, 3304},
    {3510, 3617, 3706, 3781, 3842, 3891, 3930, 3958, 3975, 3982,
     3979, 3965, 3939, 3901, 3850, 3785, 3705, 3610, 3498, 3371},
    {3465, 3581, 3678, 3758, 3825, 3879, 3921, 3952, 3973, 3984,
     3985, 3975, 3954, 3921, 3875, 3817, 3745, 3658, 3556, 3439},
    {3421, 3547, 3651, 3738, 3810, 3869, 3915, 3951, 3975, 3990,
     3994, 3988, 3971, 3943, 3903, 3851, 3786, 3708, 3615, 3508},
    {3379, 3515, 3628, 3722, 3800, 3863, 3913, 3952, 3981, 3998,
     4006, 4004, 3991, 3968, 3934, 3888, 3830, 3759, 3675, 3578},
    {3338, 3486, 3608, 3709, 3792, 3861, 3915, 3958, 3990, 4011,
     4022, 4024, 4015, 3996, 3967, 3926, 3875, 3811, 3736, 3647},
    {3300, 3460, 3592, 3700, 3790, 3863, 3922, 3968, 4003, 4028,
     4042, 4047, 4042, 4027, 4002, 3967, 3921, 3865, 3797, 3717},
    {3266, 3439, 3581, 3697, 3793, 3871, 3934, 3984, 4022, 4049,
     4067, 4074, 4073, 4061, 4041, 4011, 3970, 3920, 3859, 3787},
    {3237, 3424, 3577, 3701, 3803, 3885, 3952, 4005, 4046, 4076,
     4096, 4106, 4108, 4100, 4083, 4057, 4021, 3977, 3922, 3858},
    {3217, 3419, 3582, 3714, 3821, 3908, 3978, 4034, 4077, 4109,
     4131, 4144, 4148, 4142, 4129, 4107, 4076, 4036, 3987, 3929},
    {3209, 3426, 3599, 3738, 3851, 3941, 4014, 4072, 4117, 4150,
     4174, 4188, 4194, 4191, 4180, 4161, 4133, 4098, 4054, 4002},
}};  // VMC_J21
static const std::array<std::array<short, 20>, 20> VMC_J22 = {{
    {4002, 3929, 3858, 3787, 3717, 3647, 3578, 3508, 3439, 3371,
     3304, 3240, 3179, 3122, 3071, 3026, 2990, 2963, 2946, 2940},
    {4054, 3987, 3922, 3859, 3797, 3736, 3675, 3615, 3556, 3498,
     3442, 3389, 3339, 3293, 3254, 3221, 3196, 3180, 3419, 3180},
    {4098, 4036, 3977, 3920, 3865, 3811, 3759, 3708, 3658, 3610,
     3564, 3520, 3481, 3446, 3416, 3394, 3380, 3375, 3380, 3397},
    {4133, 4076, 4021, 3970, 3921, 3875, 3830, 3786, 3745, 3705,
     3668, 3634, 3604, 3578, 3559, 3546, 3542, 3546, 3561, 3588},
    {4161, 4107, 4057, 4011, 3967, 3926, 3888, 3851, 3817, 3785,
     3756, 3730, 3708, 3691, 3680, 3790, 3681, 3694, 3718, 3753},
    {4180, 4129, 4083, 4041, 4002, 3967, 3934, 3903, 3875, 3850,
     3828, 3809, 3795, 3786, 3782, 3786, 3798, 3819, 3850, 3892},
    {4191, 4142, 4100, 4061, 4027, 3996, 3968, 3943, 3921, 3901,
     3885, 3873, 3865, 3862, 3865, 3876, 3894, 3921, 3959, 4007},
    {4194, 4148, 4108, 4073, 4042, 4015, 3991, 3971, 3954, 3939,
     3929, 3922, 3951, 3922, 3931, 3947, 3970, 4003, 4046, 4099},
    {4188, 4144, 4106, 4074, 4047, 4024, 4004, 3988, 3975, 3965,
     3959, 3957, 3959, 3967, 3980, 4000, 4028, 4065, 4112, 4169},
    {4174, 4131, 4096, 4067, 4042, 4022, 4006, 3994, 3985, 3979,
     3977, 3979, 3986, 3997, 4015, 4039, 4070, 4111, 4160, 4221},
    {4150, 4109, 4076, 4049, 4028, 4011, 3998, 3990, 3984, 3982,
     3984, 3990, 4000, 4015, 4036, 4063, 4098, 4140, 4192, 4255},
    {4117, 4077, 4046, 4022, 4003, 3990, 3981, 3975, 3973, 3975,
     3981, 3990, 4003, 4022, 4045, 4075, 4112, 4157, 4210, 4274},
    {4072, 4034, 4005, 3984, 3968, 3958, 3952, 3951, 3952, 3958,
     3966, 3979, 3996, 4017, 4043, 4076, 4115, 4161, 4216, 4280},
    {4014, 3978, 3952, 3934, 3922, 3915, 3913, 3915, 3921, 3930,
     3942, 3958, 3978, 4002, 4031, 4066, 4107, 4155, 4210, 4275},
    {3941, 3908, 3885, 3871, 3863, 3861, 3863, 3869, 3879, 3891,
     3908, 3927, 3951, 3978, 4010, 4047, 4089, 4139, 4195, 4261},
    {3851, 3821, 3803, 3793, 3790, 3792, 3800, 3810, 3825, 3842,
     3863, 3886, 3913, 3944, 3979, 4018, 4063, 4114, 4172, 4237},
    {3738, 3714, 3701, 3697, 3700, 3709, 3722, 3738, 3758, 3781,
     3806, 3834, 3865, 3900, 3938, 3980, 4028, 4080, 4140, 4206},
    {3599, 3582, 3577, 3581, 3592, 3608, 3628, 3651, 3678, 3706,
     3737, 3771, 3807, 3845, 3888, 3933, 3984, 4039, 4100, 4167},
    {3426, 3419, 3424, 3439, 3460, 3486, 3515, 3547, 3581, 3617,
     3654, 3694, 3736, 3780, 3827, 3877, 3930, 3988, 4052, 4121},
    {3209, 3217, 3237, 3266, 3300, 3338, 3379, 3421, 3465, 3510,
     3556, 3603, 3652, 3702, 3754, 3809, 3867, 3929, 3995, 4067},
}};  // VMC_J22

static const float LQR_DATA_SLOPE[12] = {
    -98.19939,
    -21.80430,
    -3.98416,
    -8.05464,
    -54.82419,
    -6.16586,
    1.85127,
    0.75160,
    -17.52288,
    -17.79258,
    35.24155,
    5.43032,
};

static const CMSISMat<2, 6> LQR_K_SLOPE(LQR_DATA_SLOPE);

static const float LQR_DATA_YINT[12] = {
    -13.83995,
    -0.63297,
    -10.72598,
    -11.48471,
    32.57948,
    4.37475,
    15.64019,
    1.95236,
    9.22781,
    9.81441,
    47.93942,
    3.95200,
};

static const CMSISMat<2, 6> LQR_K_YINT(LQR_DATA_YINT);

}  // namespace aruwsrc::chassis

#endif