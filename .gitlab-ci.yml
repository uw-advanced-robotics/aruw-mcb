before_script:
  - python -V # Print out python version for debugging

cpplint:
  image: aruw/mcb-2020-gitlab-ci:2020-02-17.3
  before_script:
    - chmod +x ./.gitlab/linter.sh
  script:
    - ./.gitlab/linter.sh
  only:
  - merge_requests
  - master
  - develop

build-code:
  image: aruw/mcb-2020-gitlab-ci:2020-02-17.3
  script:
    - cd mcb-2019-2020-project # Go to robot code diretory
    - rm -r modm # Because lbuild clean is broken
    - lbuild build # Make sure that modm is setup for linux.
    - /usr/bin/env python3 $(which scons) build -j2 additional-ccflags=-Werror # Build the robot code!
  variables:
    GIT_SUBMODULE_STRATEGY: recursive
  only:
    - merge_requests
    - master
    - develop
