before_script:
  - python -V # Print out python version for debugging

clang-format:
  image: aruw/mcb-2020-gitlab-ci:2020-05-25.1
  script:
    - python3 /run-clang-format.py --clang-format-executable clang-format-10 -r mcb-2019-2020-project/src/ mcb-2019-2020-project/test/
  only:
  - merge_requests
  - master
  - develop

build-code:
  image: aruw/mcb-2020-gitlab-ci:2020-05-25.1
  script:
    - cd mcb-2019-2020-project # Go to robot code diretory
    - rm -r modm # Because lbuild clean is broken
    - lbuild build # Make sure that modm is setup for linux.
    - cd sim-modm && sed -i -e 's/hosted-windows/hosted-linux/g' project.xml && lbuild build && cd -
    - /usr/bin/env python3 $(which scons) build -j2 additional-ccflags=-Werror # Build the robot code!
    - /usr/bin/env python3 $(which scons) run-tests -j2 # Build the code for simulation
  variables:
    GIT_SUBMODULE_STRATEGY: recursive
  only:
    - merge_requests
    - master
    - develop

pages:
  image: alpine
  before_script:
    - apk update
    - apk add py-pip python3-dev
    - apk add make
    - apk add --no-cache g++ gcc libxml2-dev libxslt-dev
    - pip3 install lxml
    - pip3 install sphinx breathe exhale
    - pip install sphinx_rtd_theme
    - apk add doxygen
  script:
    - cd docs && make html
    - mv _build/html/ ../public/
  artifacts:
    paths:
      - public
  only:
    - develop